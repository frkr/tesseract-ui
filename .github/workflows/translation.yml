# Copyright (c) 2025 Davi Saranszky Mesquita. All rights reserved.
# See LICENSE for license information.

name: Translation Files

on:
  push:
    branches:
      - dev
    paths:
      - 'messages/**'
      - 'project.inlang/**'
      - 'README.md'
      - 'terminology.md'
  workflow_dispatch:

jobs:
  translation:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Install pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 10

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Install Cursor CLI
        run: |
          curl https://cursor.com/install -fsS | bash
          export PATH="$HOME/.cursor/bin:$PATH"
          echo "$HOME/.cursor/bin" >> $GITHUB_PATH

      - name: Run Cursor Agent
        env:
          CURSOR_API_KEY: ${{ secrets.CURSOR_API_KEY }}
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          export PATH="$HOME/.cursor/bin:$PATH"
          git config --local user.email "ai@ideias.casa"
          git config --local user.name "AI"
          cursor-agent -p --model auto --force --output-format text "You have full access to git, GitHub CLI, and PR operations. You can also run any command you want.
          First, check the terminologies in the '/terminology.md' file and update '/messages' accordingly (Remember, the '/terminology.md' is for everything in the project, correct the '/terminology.md' file to respect that directive).
          Then, check all languages in the '/project.inlang' folder and check all translation messages in the '/messages' folder. Add new languages if necessary.
          The file 'src/routes/user/profile/+page.svelte' must have a way to change the language.
          Validate translations using 'pnpm run paraglide:compile' and check if there are any errors and fix them.
          Finally, in the README.md you will find out what language this project uses as the main language and create the 'summary' in that language.
          Do not create aditional files like "VALIDACAO_TRADUCOES.md" or "SUMMARY_TRADUCAO.md" like that.
          If there are any changes, commit using the summary and push it."