# Copyright (c) 2025 Davi Saranszky Mesquita. All rights reserved.
# See LICENSE for license information.

name: Translation Files

on:
  push:
    branches:
      - dev
    paths:
      - 'messages/**'
      - 'project.inlang/**'
      - 'README.md'
      - 'terminology.md'
  workflow_dispatch:

jobs:
  cursor:
    runs-on: ubuntu-latest
    permissions:
      contents: write
      pull-requests: write

    steps:
      - name: Checkout code
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: Install pnpm
        uses: pnpm/action-setup@v4
        with:
          version: 10

      - name: Install dependencies
        run: pnpm install --frozen-lockfile

      - name: Install Cursor CLI
        run: |
          curl https://cursor.com/install -fsS | bash
          export PATH="$HOME/.cursor/bin:$PATH"
          echo "$HOME/.cursor/bin" >> $GITHUB_PATH

      - name: Run Cursor Agent
        env:
          CURSOR_API_KEY: ${{ secrets.CURSOR_API_KEY }}
          GH_TOKEN: ${{ secrets.GH_TOKEN }}
        run: |
          export PATH="$HOME/.cursor/bin:$PATH"
          git config --local user.email "ai@ideias.casa"
          git config --local user.name "AI"
          cursor-agent -p --model auto --force --output-format text "You have full access to git, GitHub CLI, and PR operations. You can also run any command you want.
          First, check terminology's on '/terminology.md' file and update '/messages' accordingly.
          Then, Check all languages on '/project.inlang' folder and Check all translation messages on '/messages' folder.
          Validate translations using 'pnpm run paraglide:compile' and check if there are any errors and fix them.
          Finally, on README.md you will find out what language this project uses as main language and create the 'summary' on that language.
          If has any changes, create an issue with the summary and label 'translation' (this label you need to use the main language discovered on readme.md)
          Add all changes, if any, to a new branch named 'feat/translation-***' (where *** its the issue title) and commit them using the summary that you will create as comment (add the issue link on body),
          Create a pull request to 'dev' branch with that summary (add the issue link on body) and Link the pull request with the issue and issue with the pull request.
          Do not open an issue or pull request until you have finished all the steps and has any changes."
